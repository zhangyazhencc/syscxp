HOST: http://192.168.211.99/

# Tunnel [/tunnel/api]

### 手动创建Tunnel [APICreateTunnelManualMsg]

+ 权限
        
        tunnel:tunnel:create    adminOnly = true

+ 参数（默认必填）：
    + 客户：
    + 名称
    + 描述：非必填
    + 连接点：
        + 1.若选云
            + 从**CloudVO**中列出所有云类型,页面显示**name**,选择一个传参**uuid**(通用查询：**APIQueryCloudMsg**)
            + 再选择，**cloudType**为选择的云类型**uuid**,**state**为**Enabled** 的连接点（通用查询：**APIQueryEndpointMsg**）
        + 2.若选**IDC**
            + 通过**province**选择节点（查询：**APIListProvinceNodeMsg** | **APIQueryNodeMsg**）
            + 再选择该节点下，**endpointType**为**ACCESSIN**，**state**为**Enabled** 的连接点（通用查询：**APIQueryEndpointMsg**）
    + 接口选择：选择该连接点下，**state = Paid** 的物理接口（通用查询：**APIQueryInterfaceMsg**）
    + 外部VLAN：1~4094   可自动分配**VLAN**（查询：**APIGetVlanAutoMsg**）
    + 若  接口类型为**QINQ**
        + 填内部**VLAN**段
    + 带宽：查询带宽规格表，列出显示**name**,传参**uuid**（通用查询：**APIQueryBandwidthOfferingMsg**）
    + 网络质量：通过两端连接点查询是否存在互联连接点（查询：**APIListInnerEndpointMsg**），如果存在，页面显示**name**，选择一个，传参**endpointUuid**
    + 付费类型
    + 付费时长

+ 请求 (application/json;charset=UTF-8)

    + Body
    
            {
                "com.syscxp.header.tunnel.tunnel.APICreateTunnelManualMsg":{
                    "accountUuid":"01d5fde22afe49b285dd54a06b369525",
                    "name":"MPLS昆山内线测试_1",
                    "description":"测试",
                    "interfaceAUuid":"50d9a4cb3ee348b3a82b6fe6ecdf2e80",
                    "aVlan":"600",
                    "interfaceZUuid":"d7fa01b95f1e482d932b1e3a0c527fe2",
                    "zVlan":"600",
                    "vlanSegment":[
                        {
                            "startVlan":100,
                            "endVlan":200
                        }
                    ],
                    "bandwidthOfferingUuid":"100M",
                    "duration":2,
                    "productChargeModel":"BY_MONTH",
                    "session":{
                        "uuid":"943b16ea85bc404eb8a00845f58e7966"
                    }
                }
            }

+ 后台验证（validate）：
    + 1.判断同一个用户的名称是否已经存在
    + 2.判断通道两端的连接点是否相同，不允许相同
    + 3.如果跨国,验证互联连接点和内外联交换机配置
    + 4.判断外部**VLAN**是否可用
    + 5.如果是**ACCESS**或是**QINQ**的物理接口，判断该物理接口是否已经开通通道
    + 6.若**QINQ**：判断同一个**switchPort**下内部**VLAN**段是否有重叠
    + 7.判断账户金额是否充足

+ 业务流程：






